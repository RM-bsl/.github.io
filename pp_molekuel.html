<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PP (Polypropylen) Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #020617; font-family: 'Inter', sans-serif; color: white; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }
        
        /* Rahmen-Design: Glas-Effekt mit dynamischer Höhe */
        .glass { 
            background: rgba(15, 23, 42, 0.75); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(16, 185, 129, 0.2); 
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ui-layer { position: absolute; inset: 0; z-index: 50; pointer-events: none; }
        .ui-content { pointer-events: auto; }
        
        /* Sidebar Design */
        .sidebar {
            width: 16rem; /* w-64 */
            height: auto;
            max-height: 90vh;
        }

        /* Animation für das Drop-Down */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
            opacity: 0;
        }
        .accordion-open .accordion-content {
            max-height: 600px;
            opacity: 1;
            padding-bottom: 1rem;
        }
        .rotate-icon {
            transition: transform 0.4s ease;
        }
        .accordion-open .rotate-icon {
            transform: rotate(180deg);
        }

        .term-highlight { color: #10b981; font-weight: 700; }
    </style>
</head>
<body>

<div id="analysis-view" class="ui-layer p-6">
    <div class="ui-content flex flex-col justify-start h-full">
        
        <!-- Dynamische Sidebar -->
        <div class="sidebar glass rounded-3xl p-5 shadow-2xl border border-emerald-500/10">
            <header class="mb-4 border-b border-emerald-500/20 pb-2">
                <h1 class="text-xl font-black text-emerald-400 tracking-tighter uppercase">
                    PP (Polypropylen)
                </h1>
            </header>

            <div class="space-y-1">
                <!-- Dropdown 1: Strukturformel -->
                <div class="accordion-item border-b border-slate-800/50" id="acc-formula">
                    <button onclick="toggleAccordion('acc-formula')" class="w-full py-2.5 flex justify-between items-center text-[10px] font-bold text-slate-400 hover:text-emerald-400 transition-colors uppercase tracking-widest">
                        Strukturformel
                        <svg class="rotate-icon w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content">
                        <div class="bg-slate-950/50 p-2 rounded-2xl border border-emerald-500/10 mt-1">
                            <svg width="100%" height="110" viewBox="0 0 200 150" class="mx-auto">
                                <line x1="10" y1="75" x2="35" y2="75" stroke="#ffffff" stroke-width="1.5" stroke-dasharray="4 2"/>
                                <line x1="165" y1="75" x2="190" y2="75" stroke="#ffffff" stroke-width="1.5" stroke-dasharray="4 2"/>
                                
                                <path d="M 45 25 L 35 25 L 35 125 L 45 125" fill="none" stroke="#64748b" stroke-width="2"/>
                                <path d="M 155 25 L 165 25 L 165 125 L 155 125" fill="none" stroke="#64748b" stroke-width="2"/>
                                
                                <text x="70" y="83" fill="#38bdf8" font-weight="bold" font-size="24" text-anchor="middle">C</text>
                                <line x1="70" y1="60" x2="70" y2="45" stroke="#ffffff" stroke-width="1.5"/>
                                <text x="70" y="38" fill="#10b981" font-size="18" text-anchor="middle">H</text>
                                <line x1="70" y1="95" x2="70" y2="110" stroke="#ffffff" stroke-width="1.5"/>
                                <text x="70" y="128" fill="#10b981" font-size="18" text-anchor="middle">H</text>
                                
                                <line x1="88" y1="75" x2="112" y2="75" stroke="#ffffff" stroke-width="2"/>
                                
                                <text x="130" y="83" fill="#38bdf8" font-weight="bold" font-size="24" text-anchor="middle">C</text>
                                <line x1="130" y1="60" x2="130" y2="45" stroke="#ffffff" stroke-width="1.5"/>
                                <text x="130" y="38" fill="#38bdf8" font-weight="bold" font-size="14" text-anchor="middle">CH3</text>
                                <line x1="130" y1="95" x2="130" y2="110" stroke="#ffffff" stroke-width="1.5"/>
                                <text x="130" y="128" fill="#10b981" font-size="18" text-anchor="middle">H</text>
                                
                                <text x="172" y="130" fill="#10b981" font-style="italic" font-weight="bold" font-size="18">n</text>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Dropdown 2: Analyse & Begriffe -->
                <div class="accordion-item" id="acc-analysis">
                    <button onclick="toggleAccordion('acc-analysis')" class="w-full py-2.5 flex justify-between items-center text-[10px] font-bold text-slate-400 hover:text-emerald-400 transition-colors uppercase tracking-widest">
                        Analyse & Begriffe
                        <svg class="rotate-icon w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content">
                        <div class="space-y-3 text-[10px] text-slate-400 leading-tight pt-2">
                            
                            <section class="p-2.5 bg-emerald-500/5 rounded-2xl border border-emerald-500/10">
                                <h4 class="text-emerald-400 font-bold uppercase text-[8px] mb-1 italic">1. Sterische Hinderung</h4>
                                <p>Die Seitengruppe (CH3) braucht viel Platz. Sie stoesst Nachbaratome ab. Das macht die Kette steifer und den Kunststoff fester als Polyethylen.</p>
                            </section>
                            
                            <section class="p-2.5 bg-emerald-500/5 rounded-2xl border border-emerald-500/10">
                                <h4 class="text-emerald-400 font-bold uppercase text-[8px] mb-1 italic">2. Taktizitaet</h4>
                                <p>Die Methylgruppen koennen alle auf einer Seite liegen (isotaktisch). Das fuehrt zu einer hohen Ordnung und einem hohen Schmelzpunkt von ca. 160 Grad.</p>
                            </section>

                            <section class="p-2.5 bg-emerald-500/5 rounded-2xl border border-emerald-500/10">
                                <h4 class="text-emerald-400 font-bold uppercase text-[8px] mb-1 italic">3. Zick-Zack-Geometrie</h4>
                                <p>Die Kohlenstoff-Kette bildet ein stabiles Geruest mit Winkeln von ca. 109 Grad. Dies ist die energetisch guenstigste Form.</p>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>

<script>
    let scene, camera, renderer, molecule;
    let targetRotationX = 0.3, targetRotationY = 0.5, isMouseDown = false;

    function toggleAccordion(id) {
        const item = document.getElementById(id);
        const isOpen = item.classList.contains('accordion-open');
        
        // Alle schließen
        document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
        
        // Falls es nicht offen war, jetzt öffnen
        if (!isOpen) {
            item.classList.add('accordion-open');
        }
    }

    window.onload = () => {
        initThreeJS();
        toggleAccordion('acc-analysis');
    };

    function initThreeJS() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        // Kameraabstand beibehalten für kompakte Ansicht
        camera.position.z = 55;
        
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);
        
        scene.add(new THREE.AmbientLight(0x475569, 1.4));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(15, 30, 20);
        scene.add(dirLight);
        
        createMolecule();
        animate();
        
        document.addEventListener('mousedown', () => isMouseDown = true);
        document.addEventListener('mouseup', () => isMouseDown = false);
        document.addEventListener('mousemove', (e) => { 
            if(isMouseDown) { 
                targetRotationY += e.movementX * 0.005; 
                targetRotationX += e.movementY * 0.005; 
            }
        });
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    }

    function createMolecule() {
        molecule = new THREE.Group();
        const carbonMat = new THREE.MeshStandardMaterial({ color: 0x38bdf8, roughness: 0.3, metalness: 0.2 });
        const hydrogenMat = new THREE.MeshStandardMaterial({ color: 0x10b981, roughness: 0.5 }); 
        const bondMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.4 });
        
        const cSize = 0.85;
        const hSize = 0.45;
        const bRad = 0.15;
        const units = 9; 
        const segmentX = 4.5;
        
        let cur = new THREE.Vector3(-18, 0, 0);
        let firstUnitAtoms = [];

        for (let i = 0; i < units; i++) {
            const c = new THREE.Mesh(new THREE.SphereGeometry(cSize, 32, 32), carbonMat);
            c.position.copy(cur);
            molecule.add(c);
            
            if (i < 2) firstUnitAtoms.push(c);
            
            if (i % 2 === 1) {
                // Methylgruppe (CH3)
                const methylC = new THREE.Mesh(new THREE.SphereGeometry(cSize, 32, 32), carbonMat);
                const mPos = cur.clone().add(new THREE.Vector3(0, 4, 1));
                methylC.position.copy(mPos);
                molecule.add(methylC);
                addBond(cur, mPos, bRad, bondMat, molecule);
                
                if (i < 2) firstUnitAtoms.push(methylC);
                
                const hOffs = [
                    new THREE.Vector3(1.5, 1, 0),
                    new THREE.Vector3(-1, 1.5, 1.2),
                    new THREE.Vector3(-0.5, 1, -1.5)
                ];
                hOffs.forEach(off => {
                    const hPos = mPos.clone().add(off);
                    const h = new THREE.Mesh(new THREE.SphereGeometry(hSize * 0.8, 24, 24), hydrogenMat);
                    h.position.copy(hPos);
                    molecule.add(h);
                    addBond(mPos, hPos, bRad * 0.6, bondMat, molecule);
                    if (i < 2) firstUnitAtoms.push(h);
                });

                const hTerPos = cur.clone().add(new THREE.Vector3(0, -2.5, -1.2));
                const hTer = new THREE.Mesh(new THREE.SphereGeometry(hSize, 24, 24), hydrogenMat);
                hTer.position.copy(hTerPos);
                molecule.add(hTer);
                addBond(cur, hTerPos, bRad * 0.6, bondMat, molecule);
                if (i < 2) firstUnitAtoms.push(hTer);
                
            } else {
                const h1p = cur.clone().add(new THREE.Vector3(0, 2.5, 1.5));
                const h2p = cur.clone().add(new THREE.Vector3(0, -2.5, -1.5));
                [h1p, h2p].forEach(p => {
                    const h = new THREE.Mesh(new THREE.SphereGeometry(hSize, 24, 24), hydrogenMat);
                    h.position.copy(p);
                    molecule.add(h);
                    addBond(cur, p, bRad * 0.6, bondMat, molecule);
                    if (i < 2) firstUnitAtoms.push(h);
                });
            }

            const nxt = new THREE.Vector3(cur.x + segmentX, (i % 2 === 0 ? 2.8 : -2.8), 0);
            if (i < units - 1) {
                addBond(cur, nxt, bRad, bondMat, molecule);
                cur.copy(nxt);
            }
        }

        // Rahmen um die erste Repetiereinheit erstellen
        const unitBox = new THREE.Box3();
        firstUnitAtoms.forEach(atom => unitBox.expandByObject(atom));
        
        const boxSize = new THREE.Vector3();
        unitBox.getSize(boxSize);
        const boxCenter = new THREE.Vector3();
        unitBox.getCenter(boxCenter);
        boxSize.addScalar(1.5); 

        const boxGeo = new THREE.BoxGeometry(boxSize.x, boxSize.y, boxSize.z);
        const frameMat = new THREE.MeshBasicMaterial({ color: 0x38bdf8, transparent: true, opacity: 0.1 });
        const frame = new THREE.Mesh(boxGeo, frameMat);
        frame.position.copy(boxCenter);
        molecule.add(frame);

        const edges = new THREE.EdgesGeometry(boxGeo);
        const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x38bdf8, transparent: true, opacity: 0.8 }));
        line.position.copy(boxCenter);
        molecule.add(line);

        molecule.position.y = -4; 
        molecule.position.x = 2;
        scene.add(molecule);
    }

    function addBond(v1, v2, rad, mat, group) {
        const dist = v1.distanceTo(v2);
        const geo = new THREE.CylinderGeometry(rad, rad, dist, 12);
        const m = new THREE.Mesh(geo, mat);
        m.position.copy(v1).lerp(v2, 0.5);
        m.quaternion.setFromUnitVectors(new THREE.Vector3(0, 1, 0), v2.clone().sub(v1).normalize());
        group.add(m);
    }

    function animate() {
        requestAnimationFrame(animate);
        if(molecule) { 
            molecule.rotation.y += (targetRotationY - molecule.rotation.y) * 0.05; 
            molecule.rotation.x += (targetRotationX - molecule.rotation.x) * 0.05; 
            if(!isMouseDown) targetRotationY += 0.0006; 
        }
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
